# 【重要】開発基本方針 - 必ず最初に読むこと

このプロジェクトでは以下の方針を厳守してください。
方針に反するコードは書かないでください。

---

## 🏗️ アーキテクチャの原則

### 1. 責務の分離
| 層 | 責務 | やること | やらないこと |
|----|------|---------|-------------|
| フロントエンド | 表示 | APIを呼ぶ、結果を表示 | 計算、データ加工 |
| バックエンド | 計算・ロジック | 計算、データ取得、加工 | 表示の制御 |
| データベース | 保存 | データの保存・取得 | ビジネスロジック |

### 2. API設計
- **1リクエスト = 1画面分のデータ**: 複数APIを組み合わせない
- **計算済みデータを返す**: フロントで再計算が不要な形で返す
- **必要な情報を全て含める**: ID だけでなく、名前も一緒に返す

### 3. 型の統一
- `product_id`, `store_id`, `category_id` → **全て文字列（string）**
- 数値と文字列の混在は禁止
- 比較時は必ず `String()` で変換してから

---

## 💻 コーディング規約

### 4. シンプルさを優先
- 複雑な機能より、確実に動くシンプルな機能
- 1つの機能が完璧に動いてから次へ
- 「あとで使うかも」のコードは書かない（YAGNI原則）

### 5. 関数は小さく
- 1つの関数は1つのことだけをする
- 50行を超えたら分割を検討
- 関数名で何をするか分かるようにする

### 6. エラーハンドリング
- 全てのAPI呼び出しに try-catch を付ける
- エラーメッセージはユーザーに分かりやすく
- コンソールにはデバッグ用の詳細を出力

### 7. デバッグログ
- 重要な処理の前後にログを出力
- 本番環境でも問題追跡できるように
- 形式: `console.log('=== 処理名 ===', { 変数1, 変数2 })`

---

## 🔄 変更時のルール

### 8. 影響範囲の確認
- コードを変更する前に、どこに影響するか確認
- 影響を受けるファイルをリストアップ
- テストすべき機能を明確にする

### 9. 段階的な変更
- 大きな変更は小さなステップに分割
- 各ステップで動作確認してからコミット
- 「一気に全部変える」は禁止

### 10. 既存機能を壊さない
- 新機能追加時、既存機能が動くことを確認
- 共通で使っている関数を変更する時は特に注意
- 不安な場合は、新しい関数を作成して徐々に移行

---

## 📁 ファイル構成の原則

### 11. 関連するコードは近くに
```
frontend/src/
  pages/          # ページコンポーネント
  components/     # 共通コンポーネント
    forecast/     # 機能別にフォルダ分け
  api/            # API呼び出し関数
  types/          # 型定義

backend/src/
  routes/         # APIエンドポイント
  services/       # ビジネスロジック
  types/          # 型定義
```

### 12. 命名規則
- ファイル名: `PascalCase.tsx`（コンポーネント）、`camelCase.ts`（その他）
- 関数名: `camelCase`（動詞で始める: `fetchData`, `calculateTotal`）
- 定数: `UPPER_SNAKE_CASE`

---

## 🧪 テストの原則

### 13. 変更後は必ず動作確認
- API変更 → Postman/curl で直接確認
- 画面変更 → ブラウザで確認
- 計算ロジック変更 → 具体的な数値で検算

### 14. エッジケースを考える
- データが0件の場合
- データが大量の場合
- 入力値が不正な場合

---

## 🚨 禁止事項

1. ❌ フロントエンドで計算処理を書く
2. ❌ 複数のAPIを組み合わせてデータを作る
3. ❌ 型を混在させる（数値と文字列）
4. ❌ エラーハンドリングなしでAPI呼び出し
5. ❌ テストせずにコミット
6. ❌ 「動いたからOK」で終わる（他の機能への影響確認必須）
7. ❌ 巨大な関数を書く（50行超え）
8. ❌ コメントなしの複雑なロジック

---

## 💾 コンテキスト節約のルール（重要）

### 15. 無駄な出力をしない
- ファイル全体を出力しない（変更箇所のみ）
- 長いログやエラーメッセージは要約する
- 「確認しました」「理解しました」などの相槌は不要

### 16. 効率的なファイル操作
- ファイルを読む前に、本当に必要か考える
- 同じファイルを何度も読まない（1回読んだら覚えておく）
- grep で必要な箇所だけ検索する

### 17. 簡潔な報告
- 報告は箇条書きで簡潔に
- 成功した場合: 結果のみ報告（過程は不要）
- 失敗した場合: エラー内容と原因のみ報告

### 18. 作業の効率化
- 試行錯誤を減らす（調べてから実行）
- 同じコマンドを何度も実行しない
- 一度で正しく書く（何度も修正しない）

### 19. 不要な確認をしない
- 明確な指示には確認なしで実行
- 「〜でよろしいですか？」は本当に必要な時だけ
- 選択肢を出す代わりに、最適な方法を選んで実行

### 20. コード出力の最小化
- 変更がない部分は `// ... 既存のコード ...` で省略
- 新規ファイルでも、説明で十分な場合はコード全文を書かない
- 差分（変更箇所）のみを明示

---

## 📝 報告フォーマット

### 成功時（簡潔に）
```
✅ 完了: [作業名]
- 変更ファイル: xxx.ts, yyy.tsx
- 結果: [簡潔な結果]
```

### 失敗時
```
❌ エラー: [作業名]
- 原因: [簡潔な原因]
- 対処: [次のアクション]
```

### 進捗報告（複数ステップの場合）
```
進捗: 3/5 完了
✅ Step 1: xxx
✅ Step 2: yyy
✅ Step 3: zzz
⏳ Step 4: 作業中
◯ Step 5: 未着手
```

---

## ✅ 作業開始前のチェックリスト

- [ ] この方針を読んだ
- [ ] 変更の影響範囲を確認した
- [ ] 作業をステップに分割した
- [ ] 各ステップの完了条件を明確にした

---

## 📝 コミットメッセージの形式

```
種別: 簡潔な説明
- 詳細1
- 詳細2
```

種別:
- `feat`: 新機能
- `fix`: バグ修正
- `refactor`: リファクタリング
- `docs`: ドキュメント
- `style`: フォーマット修正
- `perf`: パフォーマンス改善

---

この方針に従って開発を進めてください。
不明点があれば、作業を始める前に確認してください。
